---
import { Button } from "@/components/ui/button";
import Logo from "@/components/Logo.astro";

const user = Astro.locals.user;
const currentPath = Astro.url.pathname;

// Helper function to determine if link is active
const isActive = (path: string) => currentPath.startsWith(path);
---

<header
  class="sticky top-0 z-50 w-full border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"
>
  <div class="container flex h-14 sm:h-16 max-w-screen-2xl items-center px-4 sm:px-6">
    <div class="mr-4 flex">
      <a href="/" class="mr-4 sm:mr-6 flex items-center space-x-2 transition-opacity hover:opacity-80">
        <Logo />
      </a>
    </div>
    <div class="flex flex-1 items-center justify-end space-x-2 sm:space-x-4">
      <nav class="flex items-center gap-2 sm:gap-3">
        {
          user ? (
            <>
              {
                /* @ts-expect-error - user.role is added by middleware */
                user.role === "client" && (
                  <>
                    <a
                      href="/generate"
                      class:list={[
                        "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
                        isActive("/generate")
                          ? "bg-accent text-accent-foreground"
                          : "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
                      ]}
                    >
                      Generator
                    </a>
                    <a
                      href="/gallery"
                      class:list={[
                        "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
                        isActive("/gallery")
                          ? "bg-accent text-accent-foreground"
                          : "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
                      ]}
                    >
                      Galeria
                    </a>
                  </>
                )
              }
              <a
                href="/dashboard"
                class:list={[
                  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
                  isActive("/dashboard")
                    ? "bg-accent text-accent-foreground"
                    : "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
                ]}
              >
                Panel
              </a>
              <form method="POST" action="/api/auth/logout">
                <Button type="submit" size="sm" class="text-sm sm:text-base">
                  Wyloguj
                </Button>
              </form>
            </>
          ) : (
            <>
              <a
                href="/login"
                class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5"
              >
                Zaloguj się
              </a>
              <a
                href="/register"
                class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive bg-primary text-primary-foreground shadow-xs hover:bg-primary/90 h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5"
              >
                Zarejestruj się
              </a>
            </>
          )
        }
      </nav>
    </div>
  </div>
</header>
