---
import Layout from "@/layouts/Layout.astro";

const searchParams = Astro.url.searchParams;
const type = searchParams.get("type");
const token = searchParams.get("token");

let message = "";
let success = false;

if (type === "signup" && token) {
  // Verify the email confirmation token
  const { error } = await Astro.locals.supabase.auth.verifyOtp({
    token_hash: token,
    type: "signup",
  });

  if (error) {
    message = "Link aktywacyjny jest nieprawidłowy lub wygasł. Spróbuj zarejestrować się ponownie.";
    success = false;
  } else {
    message = "Twoje konto zostało pomyślnie aktywowane! Możesz się teraz zalogować.";
    success = true;
  }
} else {
  message = "Nieprawidłowy link potwierdzający.";
  success = false;
}
---

<Layout title="Potwierdzenie konta - ChairAI">
  <main class="min-h-screen flex items-center justify-center px-4 py-12 bg-background">
    <div class="w-full max-w-md space-y-8">
      <div class="text-center space-y-2">
        <h1 class="text-3xl font-bold tracking-tight">Potwierdzenie konta</h1>
      </div>

      <div class="bg-card p-8 rounded-lg border shadow-sm">
        <div
          class={`p-4 text-sm rounded-md ${
            success
              ? "text-green-800 bg-green-50 dark:text-green-200 dark:bg-green-900/20 border border-green-200 dark:border-green-800"
              : "text-destructive bg-destructive/10 border border-destructive/20"
          }`}
          role="alert"
        >
          <p>{message}</p>
        </div>

        <div class="mt-6 text-center">
          {
            success ? (
              <a
                href="/login"
                class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
              >
                Przejdź do logowania
              </a>
            ) : (
              <a
                href="/register"
                class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
              >
                Spróbuj ponownie
              </a>
            )
          }
        </div>
      </div>
    </div>
  </main>
</Layout>
