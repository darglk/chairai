---
/**
 * Artisan Profile View Page
 * 
 * Displays the artisan's complete profile in read-only mode.
 * This is the view shown after completing profile setup.
 * 
 * Access: Authenticated artisans only
 */

import Layout from "@/layouts/Layout.astro";

// Get authenticated user
const { data: { user } } = await Astro.locals.supabase.auth.getUser();

// Redirect to login if not authenticated
if (!user) {
  return Astro.redirect("/login");
}

// Get user role
const { data: userData } = await Astro.locals.supabase
  .from("users")
  .select("role")
  .eq("id", user.id)
  .single();

// Redirect to home if not an artisan
if (!userData || userData.role !== "artisan") {
  return Astro.redirect("/");
}
---

<Layout title="Mój Profil - ChairAI">
  <main class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold mb-2">Mój Profil Rzemieślnika</h1>
      <p class="text-muted-foreground">
        Twój profil jest gotowy! Możesz go edytować w dowolnym momencie.
      </p>
    </div>

    <!-- Success Message -->
    <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-8">
      <div class="flex items-center gap-3 mb-3">
        <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <h2 class="text-xl font-semibold text-green-900">Profil utworzony pomyślnie!</h2>
      </div>
      <p class="text-green-800">
        Twój profil zawodowy został zapisany. Klienci będą mogli znaleźć Cię w marketplace po opublikowaniu profilu.
      </p>
    </div>

    <!-- Actions -->
    <div class="flex flex-col sm:flex-row gap-4 mb-8">
      <a 
        href="/profile/edit" 
        class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
      >
        Edytuj profil
      </a>
      <a 
        href="/" 
        class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"
      >
        Powrót do strony głównej
      </a>
    </div>

    <!-- Profile Preview -->
    <div class="bg-card border rounded-lg p-6 space-y-6">
      <div>
        <h3 class="text-lg font-semibold mb-4">Podgląd profilu</h3>
        <p class="text-sm text-muted-foreground mb-4">
          Aby zobaczyć szczegóły swojego profilu, kliknij "Edytuj profil" powyżej.
        </p>
      </div>

      <!-- Quick Stats -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div class="bg-muted/50 rounded-lg p-4">
          <div class="text-2xl font-bold text-primary">✓</div>
          <div class="text-sm font-medium mt-2">Dane firmy</div>
          <div class="text-xs text-muted-foreground">Uzupełnione</div>
        </div>
        <div class="bg-muted/50 rounded-lg p-4">
          <div class="text-2xl font-bold text-primary">✓</div>
          <div class="text-sm font-medium mt-2">Specjalizacje</div>
          <div class="text-xs text-muted-foreground">Wybrane</div>
        </div>
        <div class="bg-muted/50 rounded-lg p-4">
          <div class="text-2xl font-bold text-primary">✓</div>
          <div class="text-sm font-medium mt-2">Portfolio</div>
          <div class="text-xs text-muted-foreground">Dodane zdjęcia</div>
        </div>
      </div>

      <!-- Next Steps -->
      <div class="border-t pt-6">
        <h3 class="text-lg font-semibold mb-4">Kolejne kroki</h3>
        <ul class="space-y-3">
          <li class="flex items-start gap-3">
            <span class="flex-shrink-0 w-6 h-6 rounded-full bg-primary/10 text-primary flex items-center justify-center text-sm font-semibold">1</span>
            <div>
              <div class="font-medium">Sprawdź swój profil</div>
              <div class="text-sm text-muted-foreground">Upewnij się, że wszystkie informacje są poprawne</div>
            </div>
          </li>
          <li class="flex items-start gap-3">
            <span class="flex-shrink-0 w-6 h-6 rounded-full bg-primary/10 text-primary flex items-center justify-center text-sm font-semibold">2</span>
            <div>
              <div class="font-medium">Opublikuj profil</div>
              <div class="text-sm text-muted-foreground">Ustaw profil jako publiczny, aby klienci mogli Cię znaleźć</div>
            </div>
          </li>
          <li class="flex items-start gap-3">
            <span class="flex-shrink-0 w-6 h-6 rounded-full bg-primary/10 text-primary flex items-center justify-center text-sm font-semibold">3</span>
            <div>
              <div class="font-medium">Przeglądaj projekty</div>
              <div class="text-sm text-muted-foreground">Znajdź interesujące projekty w marketplace i składaj oferty</div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </main>
</Layout>
